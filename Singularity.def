Bootstrap: library
From: ubuntu:22.04

%files
    src/main.cpp /opt/src
    matrixA.txt /opt
    matrixB.txt /opt


%environment
    export LC_ALL=C
    export PATH=/usr/local/bin:$PATH
    export LD_LIBRARY_PATH=/usr/lib/x86_64-linux-gnu/openmpi/lib:$LD_LIBRARY_PATH


%post
    apt-get update
    apt-get install -y build-essential \
        mpi-default-bin \
        cmake \
        mpi-default-dev \
        g++
    apt-get clean
    mkdir -p /opt
    mkdir -p /opt/src
    mpicc -o /opt/main /opt/src/main.cpp

%runscript
    mpirun -n 2 ./opt/main
    
%labels
    Author TerranaZechini