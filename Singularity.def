Bootstrap: library
From: ubuntu:22.04

%files
    ./ /opt


%environment
    export LC_ALL=C
    export PATH=/opt/exec:$PATH


%post
    apt-get update
    apt-get install -y build-essential \
        mpi-default-bin \
        mpi-default-dev \
        cmake
    apt-get clean

    mkdir -p opt && cd opt
    mkdir -p build && cd build
    cmake ..
    cmake --build .
    cd ..
    cd opt && mkdir exec
    mv /opt/build/main /opt/exec
    mv /opt/matrix*.txt /opt/exec

%runscript
  mpirun -n 2 ./opt/exec/main /opt/exec/matrix*.txt
  exec echo "$@"
    

%labels
    Author TerranaZechini